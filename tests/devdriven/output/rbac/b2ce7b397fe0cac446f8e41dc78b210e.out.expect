#############################################
# /root/.user.txt:

user unknown  Anon
user alice    Admins
user bob      Readers
user frank    Writers,Other
user tim      Other
user root     Other
    

#############################################
# /root/.role.txt:

member admin-role  Admins,@root
member read-role   Readers
member write-role  Writers
member other-role  Other
member anon-role   Anon
    

#############################################
# /root/.auth.txt:

# Admins have full access to authorizations controls:
perm allow  *    admin-role  **/.user.txt
perm allow  *    admin-role  **/.role.txt
perm allow  *    admin-role  **/.auth.txt
perm allow  *    admin-role  **

# Admins have full access to hidden files.
perm allow  *    admin-role  **/.*

# Other have no access to authorization controls:
perm deny   *    *           **/.user.txt
perm deny   *    *           **/.role.txt
perm deny   *    *           **/.auth.txt

# Anonymous users have no access:
perm deny   *    anon-role   **

# All other users have GET:
perm allow  GET  *           **
    

#############################################
# /root/a/.auth.txt:

perm allow GET other-role     *
perm allow PUT a-writer-role  writable.txt
    

#############################################
# /root/a/b/.auth.txt:

perm allow GET read-role   *
perm allow PUT write-role  *.txt
    

#############################################
# /root/a/b/c/.auth.txt:
None


#  user unknown Anon
#  user alice Admins
#  user bob Readers
#  user frank Writers,Other
#  user tim Other
#  user root Other
#  member admin-role Admins
#  member admin-role root
#  member read-role Readers
#  member write-role Writers
#  member other-role Other
#  member anon-role Anon
#  role admin-role
#  role read-role
#  role write-role
#  role other-role
#  role anon-role

# ############################################
# =========================================

# identity unknown
#   groups = ['Anon']
#   roles = ['anon-role']
assert fut('/nope', 'GET', 'unknown')           == [('deny', '*', 'anon-role', '/**'), ('allow', 'GET', '*', '/**')]

# identity alice
#   groups = ['Admins']
#   roles = ['admin-role']
assert fut('/nope', 'GET', 'alice')             == [('allow', '*', 'admin-role', '/**'), ('allow', 'GET', '*', '/**')]

# identity root
#   groups = ['Other']
#   roles = ['admin-role', 'other-role']
assert fut('/nope', 'GET', 'root')              == [('allow', '*', 'admin-role', '/**'), ('allow', 'GET', '*', '/**')]
# =========================================

# identity unknown
#   groups = ['Anon']
#   roles = ['anon-role']
assert fut('/.hidden', 'GET', 'unknown')        == [('deny', '*', 'anon-role', '/**'), ('allow', 'GET', '*', '/**')]

# identity alice
#   groups = ['Admins']
#   roles = ['admin-role']
assert fut('/.hidden', 'GET', 'alice')          == [('allow', '*', 'admin-role', '/**'), ('allow', 'GET', '*', '/**')]

# identity unknown
#   groups = ['Anon']
#   roles = ['anon-role']
assert fut('/a/.hidden', 'GET', 'unknown')      == [('deny', '*', 'anon-role', '/**'), ('allow', 'GET', '*', '/**')]

# identity alice
#   groups = ['Admins']
#   roles = ['admin-role']
assert fut('/a/.hidden', 'GET', 'alice')        == [('allow', '*', 'admin-role', '/**'), ('allow', '*', 'admin-role', '/**/.*'), ('allow', 'GET', '*', '/**')]

# identity unknown
#   groups = ['Anon']
#   roles = ['anon-role']
assert fut('/a/b/.hidden', 'GET', 'unknown')    == [('deny', '*', 'anon-role', '/**'), ('allow', 'GET', '*', '/**')]

# identity alice
#   groups = ['Admins']
#   roles = ['admin-role']
assert fut('/a/b/.hidden', 'GET', 'alice')      == [('allow', '*', 'admin-role', '/**'), ('allow', '*', 'admin-role', '/**/.*'), ('allow', 'GET', '*', '/**')]
# =========================================

# identity unknown
#   groups = ['Anon']
#   roles = ['anon-role']
assert fut('/a/1', 'GET', 'unknown')            == [('deny', '*', 'anon-role', '/**'), ('allow', 'GET', '*', '/**')]

# identity alice
#   groups = ['Admins']
#   roles = ['admin-role']
assert fut('/a/1', 'GET', 'alice')              == [('allow', '*', 'admin-role', '/**'), ('allow', 'GET', '*', '/**')]

# identity bob
#   groups = ['Readers']
#   roles = ['read-role']
assert fut('/a/1', 'GET', 'bob')                == [('allow', 'GET', '*', '/**')]

# identity frank
#   groups = ['Writers,Other']
#   roles = []
assert fut('/a/1', 'GET', 'frank')              == []

# identity tim
#   groups = ['Other']
#   roles = ['other-role']
assert fut('/a/1', 'GET', 'tim')                == [('allow', 'GET', 'other-role', '/a/*'), ('allow', 'GET', '*', '/**')]
# =========================================

# identity unknown
#   groups = ['Anon']
#   roles = ['anon-role']
assert fut('/a/b/2', 'GET', 'unknown')          == [('deny', '*', 'anon-role', '/**'), ('allow', 'GET', '*', '/**')]

# identity alice
#   groups = ['Admins']
#   roles = ['admin-role']
assert fut('/a/b/2', 'GET', 'alice')            == [('allow', '*', 'admin-role', '/**'), ('allow', 'GET', '*', '/**')]

# identity bob
#   groups = ['Readers']
#   roles = ['read-role']
assert fut('/a/b/2', 'GET', 'bob')              == [('allow', 'GET', 'read-role', '/a/b/*'), ('allow', 'GET', '*', '/**')]

# identity frank
#   groups = ['Writers,Other']
#   roles = []
assert fut('/a/b/2', 'GET', 'frank')            == []

# identity tim
#   groups = ['Other']
#   roles = ['other-role']
assert fut('/a/b/2', 'GET', 'tim')              == [('allow', 'GET', '*', '/**')]
# =========================================

# identity unknown
#   groups = ['Anon']
#   roles = ['anon-role']
assert fut('/a/b/3', 'PUT', 'unknown')          == [('deny', '*', 'anon-role', '/**')]

# identity alice
#   groups = ['Admins']
#   roles = ['admin-role']
assert fut('/a/b/3', 'PUT', 'alice')            == [('allow', '*', 'admin-role', '/**')]

# identity bob
#   groups = ['Readers']
#   roles = ['read-role']
assert fut('/a/b/3', 'PUT', 'bob')              == []

# identity frank
#   groups = ['Writers,Other']
#   roles = []
assert fut('/a/b/3', 'PUT', 'frank')            == []

# identity tim
#   groups = ['Other']
#   roles = ['other-role']
assert fut('/a/b/3', 'PUT', 'tim')              == []
# =========================================

# identity unknown
#   groups = ['Anon']
#   roles = ['anon-role']
assert fut('/a/b/c.txt', 'PUT', 'unknown')      == [('deny', '*', 'anon-role', '/**')]

# identity alice
#   groups = ['Admins']
#   roles = ['admin-role']
assert fut('/a/b/c.txt', 'PUT', 'alice')        == [('allow', '*', 'admin-role', '/**')]

# identity bob
#   groups = ['Readers']
#   roles = ['read-role']
assert fut('/a/b/c.txt', 'PUT', 'bob')          == []

# identity frank
#   groups = ['Writers,Other']
#   roles = []
assert fut('/a/b/c.txt', 'PUT', 'frank')        == []

# identity tim
#   groups = ['Other']
#   roles = ['other-role']
assert fut('/a/b/c.txt', 'PUT', 'tim')          == []
# =========================================

# identity unknown
#   groups = ['Anon']
#   roles = ['anon-role']
assert fut('/.auth.txt', 'PUT', 'unknown')      == [('deny', '*', 'anon-role', '/**')]

# identity alice
#   groups = ['Admins']
#   roles = ['admin-role']
assert fut('/.auth.txt', 'PUT', 'alice')        == [('allow', '*', 'admin-role', '/**')]

# identity alice
#   groups = ['Admins']
#   roles = ['admin-role']
assert fut('/a/.auth.txt', 'PUT', 'alice')      == [('allow', '*', 'admin-role', '/**/.auth.txt'), ('allow', '*', 'admin-role', '/**'), ('allow', '*', 'admin-role', '/**/.*'), ('deny', '*', '*', '/**/.auth.txt')]

# identity alice
#   groups = ['Admins']
#   roles = ['admin-role']
assert fut('/a/b/.auth.txt', 'PUT', 'alice')    == [('allow', '*', 'admin-role', '/**/.auth.txt'), ('allow', '*', 'admin-role', '/**'), ('allow', '*', 'admin-role', '/**/.*'), ('deny', '*', '*', '/**/.auth.txt')]

# identity alice
#   groups = ['Admins']
#   roles = ['admin-role']
assert fut('/a/b/c/.auth.txt', 'PUT', 'alice')  == [('allow', '*', 'admin-role', '/**/.auth.txt'), ('allow', '*', 'admin-role', '/**'), ('allow', '*', 'admin-role', '/**/.*'), ('deny', '*', '*', '/**/.auth.txt')]
