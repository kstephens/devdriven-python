import devdriven.version as sut
from pprint import pprint

VERSION_STRINGS = '''
1.2
1.3.45
1.3.45a
1.3.45ab
1.3.45ab4
1.3.45-ab_4
1.3_45_ab-4
'''.split('\n')

def pp(x):
  pprint(x, indent=2)

def test_parse():
  results = [(inp, sut.parse_elements(inp)) for inp in VERSION_STRINGS]
  # pp(results)
  assert results == [
    ('', []),
  ('1.2', [1, 2]),
  ('1.3.45', [1, 3, 45]),
  ('1.3.45a', [1, 3, 45, 'a']),
  ('1.3.45ab', [1, 3, 45, 'ab']),
  ('1.3.45ab4', [1, 3, 45, 'ab', 4]),
  ('1.3.45-ab_4', [1, 3, 45, 'ab', 4]),
  ('1.3_45_ab-4', [1, 3, 45, 'ab', 4]),
  ('', [])
  ]

def test_cmp():
  for a in VERSION_STRINGS:
    assert sut.Version(a).cmp(sut.Version(a), '==') == 0

  results = [(a, b, sut.Version(a).cmp(sut.Version(b), 'OP')) for a in VERSION_STRINGS for b in VERSION_STRINGS if a != b]
  pp(results)
  assert results == [
    ('', '1.2', -1),
  ('', '1.3.45', -1),
  ('', '1.3.45a', -1),
  ('', '1.3.45ab', -1),
  ('', '1.3.45ab4', -1),
  ('', '1.3.45-ab_4', -1),
  ('', '1.3_45_ab-4', -1),
  ('1.2', '', 1),
  ('1.2', '1.3.45', -1),
  ('1.2', '1.3.45a', -1),
  ('1.2', '1.3.45ab', -1),
  ('1.2', '1.3.45ab4', -1),
  ('1.2', '1.3.45-ab_4', -1),
  ('1.2', '1.3_45_ab-4', -1),
  ('1.2', '', 1),
  ('1.3.45', '', 1),
  ('1.3.45', '1.2', 1),
  ('1.3.45', '1.3.45a', -1),
  ('1.3.45', '1.3.45ab', -1),
  ('1.3.45', '1.3.45ab4', -1),
  ('1.3.45', '1.3.45-ab_4', -1),
  ('1.3.45', '1.3_45_ab-4', -1),
  ('1.3.45', '', 1),
  ('1.3.45a', '', 1),
  ('1.3.45a', '1.2', 1),
  ('1.3.45a', '1.3.45', 1),
  ('1.3.45a', '1.3.45ab', -1),
  ('1.3.45a', '1.3.45ab4', -1),
  ('1.3.45a', '1.3.45-ab_4', -1),
  ('1.3.45a', '1.3_45_ab-4', -1),
  ('1.3.45a', '', 1),
  ('1.3.45ab', '', 1),
  ('1.3.45ab', '1.2', 1),
  ('1.3.45ab', '1.3.45', 1),
  ('1.3.45ab', '1.3.45a', 1),
  ('1.3.45ab', '1.3.45ab4', -1),
  ('1.3.45ab', '1.3.45-ab_4', -1),
  ('1.3.45ab', '1.3_45_ab-4', -1),
  ('1.3.45ab', '', 1),
  ('1.3.45ab4', '', 1),
  ('1.3.45ab4', '1.2', 1),
  ('1.3.45ab4', '1.3.45', 1),
  ('1.3.45ab4', '1.3.45a', 1),
  ('1.3.45ab4', '1.3.45ab', 1),
  ('1.3.45ab4', '1.3.45-ab_4', 0),
  ('1.3.45ab4', '1.3_45_ab-4', 0),
  ('1.3.45ab4', '', 1),
  ('1.3.45-ab_4', '', 1),
  ('1.3.45-ab_4', '1.2', 1),
  ('1.3.45-ab_4', '1.3.45', 1),
  ('1.3.45-ab_4', '1.3.45a', 1),
  ('1.3.45-ab_4', '1.3.45ab', 1),
  ('1.3.45-ab_4', '1.3.45ab4', 0),
  ('1.3.45-ab_4', '1.3_45_ab-4', 0),
  ('1.3.45-ab_4', '', 1),
  ('1.3_45_ab-4', '', 1),
  ('1.3_45_ab-4', '1.2', 1),
  ('1.3_45_ab-4', '1.3.45', 1),
  ('1.3_45_ab-4', '1.3.45a', 1),
  ('1.3_45_ab-4', '1.3.45ab', 1),
  ('1.3_45_ab-4', '1.3.45ab4', 0),
  ('1.3_45_ab-4', '1.3.45-ab_4', 0),
  ('1.3_45_ab-4', '', 1),
  ('', '1.2', -1),
  ('', '1.3.45', -1),
  ('', '1.3.45a', -1),
  ('', '1.3.45ab', -1),
  ('', '1.3.45ab4', -1),
  ('', '1.3.45-ab_4', -1),
  ('', '1.3_45_ab-4', -1)]
